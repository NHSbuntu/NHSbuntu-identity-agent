import unittest
import base64
import cms


class tests_cms(unittest.TestCase):
    def setUp(self):
        self.test_challenge = base64.b64decode('MlJN9BVjTdKtTpKrSz3Jvq0sONIAAAFc7yH6TYe8NK6GHS7F7t2tGnmcost76xk7')
        self.test_cert = base64.b64decode('MIIDbzCCAlegAwIBAgIEVzHBnDANBgkqhkiG9w0BAQUFADAtMQwwCgYDVQQKEwNuaHMxCzAJBgNVBAsTAkNBMRAwDgYDVQQDEwdTdWJDQTAyMB4XDTE2MTEyMjE2MTgxOVoXDTE4MTEyMjE2NDgxOVowNjEMMAoGA1UEChMDbmhzMQ8wDQYDVQQLEwZwZW9wbGUxFTATBgNVBAMTDDEwMjA0ODg0Mzk4MzCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAp/9RZ9baYvAj/LnBy8TaQeUrDJYYK7bbXj8l9IijmHbb+icAjbb0qkof+lrcqYLHShh5oUdStOO5i+u38VTsCaoZu6cwMls/XO2peJMJFFnwfLL9FIvGtC5Kg9p65jAX0YvE/qlT4seeGQK7q6Nax1NrtUStX05n7cUuiu7Ji/cCAwEAAaOCARAwggEMMAsGA1UdDwQEAwIHgDAYBgNVHSAEETAPMA0GCyqGOgCJe2UAAwEBMFAGA1UdHwRJMEcwRaBDoEGkPzA9MQwwCgYDVQQKEwNuaHMxCzAJBgNVBAsTAkNBMRAwDgYDVQQDEwdTdWJDQTAyMQ4wDAYDVQQDEwVDUkw1NzArBgNVHRAEJDAigA8yMDE2MTEyMjE2MTgxOVqBDzIwMTgxMTIyMTY0ODE5WjAfBgNVHSMEGDAWgBQSSoi3gsCYCcPcpsZpewnlLvD2BTAdBgNVHQ4EFgQUlQvtlbbgKoJmZVE2FszB4wJWP70wCQYDVR0TBAIwADAZBgkqhkiG9n0HQQAEDDAKGwRWOC4xAwIEsDANBgkqhkiG9w0BAQUFAAOCAQEAbEGtl/aHjbafhCyq7gSLq++wN5eCMvxBVZ8cbXR1qWDBr0EBkmq7AUr19HtR5OG+lCTA/uRcAMDqvKp4GgRd0MmdjwfJzqwZH2ztLcg9zqw1t4nfRUwa1kN1aXSNlgw59iBYqDr4w0MVY8ioGZyoIT6S6/DVgH32HLpKo1hkKXJSvd8H2R20FBdTR5D03Ka8yfIRftIsH74C5Ikl3Zaz58ifmLSUUdEjnRufKyf1OZ5RTzTub+ubD1C5Mdx2RB2zPbt3pR16YK3OXTnPMsbIaO9NKHrbZSqbHALsC7nBhEY4ipxr8UjFg2ZcEDPvdIQiHj+Z4U2xGn3kJ7Gmo91STQ==')
        self.test_signature = b'=*\xf5\x81\xc7\x15_\x0f\xd9\xf8L\xcdhr\xde\x84M\xfdd\x89\x9fG\xa4\xe4\xe7V\xe2a\x1d+\xfbD\xbc`\xe8p\xaf\xa7JZ\x1d\xb25\xa1\x9a\\\xdap@\x96\xa4s\x1dh\xba\x13)]\x014n\x93\x13\x07\x1e\xe5&DwG#Zo;\xad\xae\x14\xb3e\xf7=\x1fj\x01\x8cZ\x1crs\xb1N\x8eWd\x9c\x1f8qcl\xaf\xd7~\xa8\x9dmP\x95\x84?]\xf8A\\\xe4\x11\t\xbb>\x10X\x8a|\xd5+\xe0\xaf('

    def test_build_asn1(self):
        expected_result = b'0\x82\x04\x8d\x06\t*\x86H\x86\xf7\r\x01\x07\x02\xa0\x82\x04~0\x82\x04z\x02\x01\x011\x0b0\t\x06\x05+\x0e\x03\x02\x1a\x05\x000\x14\x06\t*\x86H\x86\xf7\r\x01\x07\x01\xa0\x07\x04\x05\xd9\x13\x1c0\xd2\xa0\x82\x03s0\x82\x03o0\x82\x02W\xa0\x03\x02\x01\x02\x02\x04W1\xc1\x9c0\r\x06\t*\x86H\x86\xf7\r\x01\x01\x05\x05\x000-1\x0c0\n\x06\x03U\x04\n\x13\x03nhs1\x0b0\t\x06\x03U\x04\x0b\x13\x02CA1\x100\x0e\x06\x03U\x04\x03\x13\x07SubCA020\x1e\x17\r161122161819Z\x17\r181122164819Z061\x0c0\n\x06\x03U\x04\n\x13\x03nhs1\x0f0\r\x06\x03U\x04\x0b\x13\x06people1\x150\x13\x06\x03U\x04\x03\x13\x0c1020488439830\x81\x9f0\r\x06\t*\x86H\x86\xf7\r\x01\x01\x01\x05\x00\x03\x81\x8d\x000\x81\x89\x02\x81\x81\x00\xa7\xffQg\xd6\xdab\xf0#\xfc\xb9\xc1\xcb\xc4\xdaA\xe5+\x0c\x96\x18+\xb6\xdb^?%\xf4\x88\xa3\x98v\xdb\xfa\'\x00\x8d\xb6\xf4\xaaJ\x1f\xfaZ\xdc\xa9\x82\xc7J\x18y\xa1GR\xb4\xe3\xb9\x8b\xeb\xb7\xf1T\xec\t\xaa\x19\xbb\xa702[?\\\xed\xa9x\x93\t\x14Y\xf0|\xb2\xfd\x14\x8b\xc6\xb4.J\x83\xdaz\xe60\x17\xd1\x8b\xc4\xfe\xa9S\xe2\xc7\x9e\x19\x02\xbb\xab\xa3Z\xc7Sk\xb5D\xad_Ng\xed\xc5.\x8a\xee\xc9\x8b\xf7\x02\x03\x01\x00\x01\xa3\x82\x01\x100\x82\x01\x0c0\x0b\x06\x03U\x1d\x0f\x04\x04\x03\x02\x07\x800\x18\x06\x03U\x1d \x04\x110\x0f0\r\x06\x0b*\x86:\x00\x89{e\x00\x03\x01\x010P\x06\x03U\x1d\x1f\x04I0G0E\xa0C\xa0A\xa4?0=1\x0c0\n\x06\x03U\x04\n\x13\x03nhs1\x0b0\t\x06\x03U\x04\x0b\x13\x02CA1\x100\x0e\x06\x03U\x04\x03\x13\x07SubCA021\x0e0\x0c\x06\x03U\x04\x03\x13\x05CRL570+\x06\x03U\x1d\x10\x04$0"\x80\x0f20161122161819Z\x81\x0f20181122164819Z0\x1f\x06\x03U\x1d#\x04\x180\x16\x80\x14\x12J\x88\xb7\x82\xc0\x98\t\xc3\xdc\xa6\xc6i{\t\xe5.\xf0\xf6\x050\x1d\x06\x03U\x1d\x0e\x04\x16\x04\x14\x95\x0b\xed\x95\xb6\xe0*\x82feQ6\x16\xcc\xc1\xe3\x02V?\xbd0\t\x06\x03U\x1d\x13\x04\x020\x000\x19\x06\t*\x86H\x86\xf6}\x07A\x00\x04\x0c0\n\x1b\x04V8.1\x03\x02\x04\xb00\r\x06\t*\x86H\x86\xf7\r\x01\x01\x05\x05\x00\x03\x82\x01\x01\x00lA\xad\x97\xf6\x87\x8d\xb6\x9f\x84,\xaa\xee\x04\x8b\xab\xef\xb07\x97\x822\xfcAU\x9f\x1cmtu\xa9`\xc1\xafA\x01\x92j\xbb\x01J\xf5\xf4{Q\xe4\xe1\xbe\x94$\xc0\xfe\xe4\\\x00\xc0\xea\xbc\xaax\x1a\x04]\xd0\xc9\x9d\x8f\x07\xc9\xce\xac\x19\x1fl\xed-\xc8=\xce\xac5\xb7\x89\xdfEL\x1a\xd6Cuit\x8d\x96\x0c9\xf6 X\xa8:\xf8\xc3C\x15c\xc8\xa8\x19\x9c\xa8!>\x92\xeb\xf0\xd5\x80}\xf6\x1c\xbaJ\xa3Xd)rR\xbd\xdf\x07\xd9\x1d\xb4\x14\x17SG\x90\xf4\xdc\xa6\xbc\xc9\xf2\x11~\xd2,\x1f\xbe\x02\xe4\x89%\xdd\x96\xb3\xe7\xc8\x9f\x98\xb4\x94Q\xd1#\x9d\x1b\x9f+\'\xf59\x9eQO4\xeeo\xeb\x9b\x0fP\xb91\xdcvD\x1d\xb3=\xbbw\xa5\x1dz`\xad\xce]9\xcf2\xc6\xc8h\xefM(z\xdbe*\x9b\x1c\x02\xec\x0b\xb9\xc1\x84F8\x8a\x9ck\xf1H\xc5\x83f\\\x103\xeft\x84"\x1e?\x99\xe1M\xb1\x1a}\xe4\'\xb1\xa6\xa3\xddRM1\x81\xda0\x81\xd7\x02\x01\x01050-1\x0c0\n\x06\x03U\x04\n\x13\x03nhs1\x0b0\t\x06\x03U\x04\x0b\x13\x02CA1\x100\x0e\x06\x03U\x04\x03\x13\x07SubCA02\x02\x04W1\xc1\x9c0\t\x06\x05+\x0e\x03\x02\x1a\x05\x000\r\x06\t*\x86H\x86\xf7\r\x01\x01\x01\x05\x00\x04\x81\x80=*\xf5\x81\xc7\x15_\x0f\xd9\xf8L\xcdhr\xde\x84M\xfdd\x89\x9fG\xa4\xe4\xe7V\xe2a\x1d+\xfbD\xbc`\xe8p\xaf\xa7JZ\x1d\xb25\xa1\x9a\\\xdap@\x96\xa4s\x1dh\xba\x13)]\x014n\x93\x13\x07\x1e\xe5&DwG#Zo;\xad\xae\x14\xb3e\xf7=\x1fj\x01\x8cZ\x1crs\xb1N\x8eWd\x9c\x1f8qcl\xaf\xd7~\xa8\x9dmP\x95\x84?]\xf8A\\\xe4\x11\t\xbb>\x10X\x8a|\xd5+\xe0\xaf('
        res = cms.envelope(self.test_challenge, self.test_cert, self.test_signature)

        self.assertEqual(expected_result, res)




